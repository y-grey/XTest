# XTest-Replay
### 便捷的UI录制回放工具，一键实现性能自动化，支持日常定时任务的回归。

# XTest-Replay演示
**录制，自动识别常规动作，并采集控件属性生成步骤，同时支持按键和图像识别等**

![image](https://github.com/y-grey/XTest/blob/master/screenshot/Replay/record.gif)

**回放，支持自动点掉弹窗，xpath模糊匹配，回放视频录制，监控crash和anr等，回放用例的同时采集性能，轻松实现性能自动化**

![image](https://github.com/y-grey/XTest/blob/master/screenshot/Replay/replay.gif)

# XTest-Replay使用流程介绍
## 1、下载工具并启动
确保手机处于开发者模式，启用开发者模式后需开启下面的配置
- USB 调试——必须开启
- USB 调试（安全模式）——小米手机，必须开启
- 禁止权限监控——oppo 手机，建议开启
- 充电时屏幕不休眠——建议开启

前往： [工具下载链接](https://github.com/y-grey/XTest/releases/tag/v1.0.0)

下载工具，执行 run 启动 (如果你是 mac，需要给 adb 授权：chmod 755 XTest/MacAdb/adb，再右键打开激活一下)

出现如下浮窗，则代表启动成功。其中“**最小化**”可在平时不使用工具的时候可将该窗口最小化，而“**退出**”则直接退出工具，下次启动需重新从PC端启动。建议不使用工具的时候选择”**最小化**“，不直接“**退出**”

![image](https://github.com/y-grey/XTest/blob/master/screenshot/Replay/1.png)

## 2、选择 录制回放→选择 测试应用→进入到录制回放主页面
- 该页展示了录制和任务的入口及用例列表
- 点击回放按钮则回放当前用例
- 点击用例菜单按钮
  - 修改用例配置
    - 修改用例名
    - 设置回放前清除数据(oppo 手机需要开启：开发者选项 -> 禁止权限监控)
    - 设置回放前重启应用
    - 开启性能采集
    - 设置性能阈值
  - 复制当前用例
  - 生成python用例（未实现）
  - 删除当前用例
- 其中自动创建的”弹窗点掉用例“是用于配置回放过程自动点掉弹窗的步骤，可以根据自己业务的特点添加相应的步骤

![image](https://github.com/y-grey/XTest/blob/master/screenshot/Replay/2.png)

## 3、录制回放主页面点击录制进入到录制模式，右上角显示录制浮窗，包含”完成，按键，校验，截图，上下箭头“
- 自动识别”点击，长按，滑动，输入“，并自动采集控件属性
- 需要录制”返回键，Home键“，则选择按键
- 需要校验（断言），则选择校验后，再点击需要校验的控件即可，如果需要校验不存在则需去到用例编辑页面修改
- 需要图像识别，则选择截图，支持截图点击和截图校验
- ”上下箭头“区域为可上下拖动浮窗的区域
- 点击”完成“，则结束录制并回到录制回放主页面并生成一条用例

![image](https://github.com/y-grey/XTest/blob/master/screenshot/Replay/3.png)

## 4、录制回放主页面点击用例进入到用例的详情页：
- 该页展示了用例每一步的步骤详情和回放结果
- 回放结果包括：
  - 执行结果和时间
  - 系统和应用版本
  - 如果开启了性能测试，则会显示性能结果均值和详细性能数据的文件路径
  - 如果是因为发生了crash或anr导致的失败，则显示crash或anr日志路径
  - 回放视频的查看

![image](https://github.com/y-grey/XTest/blob/master/screenshot/Replay/4.png)

## 5、用例的详情页点击步骤可对步骤进行编辑：
- 单步回放：直接回放当前步骤
- 编辑：修改步骤属性
  - 修改Activity名
  - 设置是否直接点击坐标(不执行查找控件逻辑，直接点击坐标)
  - 设置shell命令(步骤的动作类型设为”执行命令“后生效)
  - 修改控件属性(id,text,contentDesc,xPath等)
  - 修改点击按下的坐标
  - 修改时间(执行前等待时间，查找超时时间，动作持续时间等)
  - 修改动作类型(点击、长按、双击、滑动、输入、校验、校验不存在、返回键、Home键、执行命令)
- 编辑并同步到其他用例：修改步骤属性并把修改同步到其他用例(适合场景：控件某个属性发生了变化，多个用例包含了此控件，则可以批量修改)
- 复制：复制当前步骤
- 循环开始：设置当前步骤为循环的起点并设置循环n次，设置完了后需要在当前步骤或之后的步骤设置一个结束点，从而在回放时，可以在起点和结束点之间循环执行n次(适合场景：性能压测等需要循环执行步骤的场景)
- 上移：步骤上移一位
- 下移：步骤下移一位
- 插入录制步骤：启动录制模式开始录制，录制好的步骤插入到当前步骤之后
- 插入子用例：设置步骤的子用例，回放执行到有子用例的步骤，则会先执行子用例(适合场景：多个用例有相同连续步骤，可以将这些步骤抽成子用例)

![image](https://github.com/y-grey/XTest/blob/master/screenshot/Replay/5.png)

## 6、从录制回放主页面点击任务进去到任务页面：
- 创建任务并添加用例到任务里，方便的执行自动化任务
- 可设置多种不同的触发方式
  - 手动：默认方式，直接点击执行按钮触发
  - 按键：通过音量键或返回键触发，适合各种需要快速执行的步骤，比如 “秒换装备”～
  - 定时：每天定时触发，可设置每天中的多个时间触发执行任务
  - 通知：接收到指定通知后执行（暂未实现）
  - 命令：通过执行 adb shell 命令触发（暂未实现）
- 任务详情里可调整用例的执行顺序
- 从任务的菜单进去可看到执行历史、任务执行结果，用例执行结果

![image](https://github.com/y-grey/XTest/blob/master/screenshot/Replay/6.png)








